function initialize(){setMap(),setWelcomeScreen()}function setWelcomeScreen(){{var e=(d3.select("body").style("background-size","100% auto"),d3.select("body").append("div").attr("id","welcomeInfo").style("width",width-38+"px").text("In the past century advances in human technology coupled with climatic change has made the formidable arctic accessible!"));e.append("span").attr("class","startButtonBox").html("<br><br><button id='startButton' class= 'Button' onclick='changeVisibility()'>Continue</button>")}}function setMap(){function e(e,t,a,r,s,o){n.selectAll(".landMasses").data(topojson.feature(t,t.objects.landOutline).features).enter().append("g").attr("class","landMasses").append("path").attr("class","landBody").attr("d",i),n.selectAll(".eLine").data(topojson.feature(a,a.objects.Lines).features).enter().append("g").attr("class","eLine").attr("id",function(e){return e.properties.EvID}).append("path").attr("d",i).on("click",function(e){selectedEvent=e,currentYear=e.properties.startYear,updateInfoPanel(),moveHandle(),updateYear()}).on("mouseover",highlight).on("mouseout",dehighlight),n.selectAll(".ePoint").data(topojson.feature(r,r.objects.Points).features).enter().append("g").attr("class","ePoint").attr("id",function(e){return e.properties.EvID}).append("path").attr("d",i).on("click",function(e){selectedEvent=e,currentYear=e.properties.startYear,moveHandle(),updateYear(),updateInfoPanel()}).on("mouseover",highlight).on("mouseout",dehighlight);addEvents(a,r,s,o),makeInfoPanel(),makeTimeline(),makeEventLine(),selectedEvent=eventList[0],updateLines(),updatePoints(),updateInfoPanel()}var t=width-infoPanelBoxWidth-28-34,a=t,r=(d3.select("body").append("div").attr("class","shadowBox").attr("id","pageShadow").style("width",width+"px").style("height","1000px"),d3.select("body").append("div").attr("class","timelineBox").style("display","none").style("height","150px"),d3.select("body").append("div").attr("class","infoPanelBox").style("width",infoPanelBoxWidth+"px").style("display","none"),d3.select("body").append("div").attr("class","mapContainer").style("width",t+28+"px").style("height",a+28+"px").style("left",infoPanelBoxWidth+"px").style("display","none"));r.append("text").attr("class","displayYear").text(currentYear);var n=d3.select(".mapContainer").append("svg").attr("class","map").attr("width",t+"px").attr("height",a+"px"),s=d3.geo.orthographic().scale(t/1.5).rotate([0,-90,0]).translate([t/2,a/2]).clipAngle(90).precision(.1),i=d3.geo.path().projection(s),o=d3.geo.graticule();n.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",i),n.append("use").attr("class","sphereFill").attr("xlink:href","#sphere"),n.append("use").attr("class","sphereStroke").attr("xlink:href","#sphere"),n.append("path").datum(o).attr("class","graticule").attr("d",i);var l=d3.dsv(";","text/plain");queue().defer(d3.json,"data/landOutline.topojson").defer(d3.json,"data/Lines.topojson").defer(d3.json,"data/Points.topojson").defer(l,"data/treatyData.csv").defer(l,"data/introText.csv").await(e)}function highlight(e){var t=e.properties?e.properties:e;d3.selectAll(".event#"+t.EvID).style("fill","rgb(240, 240, 240)"),d3.selectAll("#"+t.EvID).style("stroke-width","5px"),$("#"+t.EvID).tooltip({content:"Hello",track:!0})}function dehighlight(e){var t=e.properties?e.properties:e;d3.selectAll("#"+t.EvID).style("stroke-width","2.5px"),d3.selectAll(".event#"+t.EvID).style("fill","transparent")}function updateYear(){var e=d3.select(".displayYear");e.text(currentYear)}function updateLines(){d3.selectAll(".eLine").style("stroke",function(e){return currentYear>=e.properties.startYear&&currentYear<=e.properties.endYear?colorize(e):"none"})}function updatePoints(){d3.selectAll(".ePoint").style("fill",function(e){return currentYear>=e.properties.startYear&&currentYear<=e.properties.endYear?colorize(e):"none"}).style("stroke",function(e){return currentYear>=e.properties.startYear&&currentYear<=e.properties.endYear?colorize(e):"none"})}function makeTimeline(){function e(){var e=s.extent()[0];d3.event.sourceEvent&&(e=n.invert(d3.mouse(this)[0]),s.extent([e,e])),d.attr("cx",n(e)),d3.select(".ghostLine").attr("x1",n(e)).attr("x2",n(e))}function t(){if(d3.event.sourceEvent){var e=s.extent()[0];s.extent([e,e]),d3.select(this).transition().duration(0).call(s.event),d3.select(this).transition().call(s.extent(s.extent().map(function(e){currentYear=d3.round(e,0);for(var t=!1;0==t;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>=2014&&(currentYear=2014,t=!0)):t=!0;return currentYear}))).call(s.event),updateInfoPanel(),updateLines(),updatePoints(),updateYear()}}var a=d3.select(".timelineBox"),r=d3.select(".timelineBox").append("span").attr("class","buttonBox"),n=(r.append("button").attr("class","Button").attr("id","backYear").on("click",function(){currentYear+=-1;for(var e=!1;0==e;)-1==$.inArray(currentYear,yearList)?(currentYear-=1,console.log(currentYear),1903>currentYear&&(currentYear=2014,e=!0)):e=!0;moveHandle(),updateYear(),updateLines(),updatePoints()}).text("<"),r.append("button").attr("class","Button").attr("id","nextYear").on("click",function(){currentYear++;for(var e=!1;0==e;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>2014&&(currentYear=1903,e=!0)):e=!0;console.log("hi"),moveHandle(),updateYear(),updateLines(),updatePoints(),updateInfoPanel()}).text(">"),d3.scale.linear().domain([1903,2014]).range([0,timelineWidth]).clamp(!0)),s=d3.svg.brush().x(n).extent([0,0]).on("brush",e).on("brushend",t),i=d3.svg.axis().scale(n).tickValues([1903,1910,1920,1930,1940,1950,1960,1970,1980,1990,2e3,2014]).tickFormat(d3.format("d")).orient("top"),o=a.append("svg").attr("width",width).attr("height",32).attr("class","timeline").append("g").attr("transform","translate(90, 25)").attr("class","axis").call(i),l=o.append("g").attr("class","slider").call(s);l.selectAll(".extent, .resize").remove();var d=l.append("circle").attr("class","handle").attr("r",7);l.call(s.event).transition().duration(750).call(s.extent([70,70])).call(s.event)}function makeEventLine(){{var e=d3.select(".timelineBox"),t=e.append("svg").attr("width",width).attr("height",116).attr("class","eventBox").append("g").attr("transform","translate(0, 0)"),a=t.append("g").attr("class","eventsLine").attr("transform","translate(90, 4)"),r=(a.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2","102").attr("class","ghostLine").style("stroke-width","1px").style("stroke","gray").attr("transform","translate(0, 0)"),a.selectAll("event").data(eventList).enter().append("circle").attr("transform",function(e){var t,a=e.properties?e.properties:e,r=timelineWidth/111*(Number(a.startYear)-1903);switch(a.Country){case"Canada":t=6;break;case"Russia":t=20;break;case"Norway":t=34;break;case"Denmark":t=48;break;case"United States":t=62;break;case"USSR":t=20;break;default:t=78}return"Yes"==a.Dispute&&(t=96),"translate("+r+", "+t+")"}).attr("stroke",function(e){return colorize(e)}).attr("r",6).attr("class","event").attr("id",function(e){var t=e.properties?e.properties:e;return t.EvID}).attr("fill","transparent").on("click",function(e){var t=e.properties?e.properties:e;currentYear=Number(t.startYear),selectedEvent=e;var a=d3.transform(d3.select(this).attr("transform")),r=a.translate[0];moveHandle(r),updateInfoPanel(),updatePoints(),updateLines(),updateYear()}).on("mouseover",highlight).on("mouseout",dehighlight),["Canada:","Russia:","Norway:","United States:","Denmark:","Treaties:","Conflicts:"]);t.selectAll("countryLabels").data(r).enter().append("g").attr("class","countryLabels").attr("id",function(e){}).append("text").text(function(e){return e}).attr("transform",function(e){switch(e){case"Canada:":y=6;break;case"Russia:":y=20;break;case"Norway:":y=34;break;case"Denmark:":y=48;break;case"United States:":y=62;break;case"Treaties:":y=78;break;case"Conflicts:":y=96}return"translate(5, "+(y+10)+")"}).attr("fill",function(e){switch(e){case"Canada:":return"rgb(27,158,119)";case"Russia:":return"rgb(217,95,2)";case"Norway:":return"rgb(117,112,179)";case"Denmark:":return"rgb(166,118,29)";case"United States:":return"rgb(102,166,30)";case"USSR:":return"rgb(217,95,2)";case"Treaties:":return"rgb(230,171,2)";case"Conflicts:":return"rgb(231,41,138)"}})}}function moveHandle(e){var t;t=e?e:timelineWidth/111*(currentYear-1903),d3.select(".handle").transition().duration(700).attr("cx",t),d3.select(".ghostLine").transition().duration(700).attr("x1",t).attr("x2",t)}function makeInfoPanel(){d3.select(".infoPanelBox").append("div").attr("id","accordion").html("<h3 id='eventName'>Event 1</h3><div><p id='eventDescrip'></p></div>"),$("#accordion").accordion({collapsible:!0,heightStyle:"content"})}function updateInfoPanel(){var e,t,a=selectedEvent.properties?selectedEvent.properties:selectedEvent;t=a.Name,e=a.Descrip,d3.select("#eventDescrip").text(e),d3.select("#eventName").text(t)}function changeVisibility(){d3.select(".timelineBox").transition().duration(1e3).style("display","block"),d3.select(".infoPanelBox").style("display","block"),d3.select(".mapContainer").style("display","block"),d3.select("#welcomeInfo").style("display","none"),d3.select("#startButton").style("display","none"),setIntroBox()}function addEvents(e,t,a,r){for(var n=e.objects.Lines.geometries,s=0;s<n.length;s++)eventList.push(n[s]),yearList.push(n[s].properties.startYear);for(var i=t.objects.Points.geometries,s=0;s<i.length;s++)eventList.push(i[s]),yearList.push(i[s].properties.startYear);for(var o=a,s=0;s<o.length;s++)eventList.push(o[s]),yearList.push(Number(o[s].startYear));for(var l=r,s=0;s<l.length;s++)introSlides.push(l[s]);console.log(introSlides[0].slideText),eventList.sort(function(e,t){var a=e.properties?e.properties:e,r=t.properties?t.properties:t;return a.startYear-r.startYear})}function setIntroBox(){is=img.toString();var e=d3.select("body").append("div").attr("class","introContainer"),t=d3.select(".introContainer").append("div").attr("class","imageBox");e.append("text").attr("class","introTitle").text("Dividing Oceans: The Basics").append("hr"),e.append("p").attr("id","intro-Slides").text(introSlides[img].slideText),t.append("img").attr("class","oceanDivide").attr("src","img/OceanDivide"+is+".png").attr("alt","ocean divide"+is).style("display","none"),e.append("button").attr("class","Button").attr("id","SkipButton").attr("onclick","hideIntro()").text("Skip"),e.append("button").attr("class","Button").attr("id","nextButton").attr("onclick","nextImg()").text("Next"),e.append("button").attr("class","Button").attr("id","backButton").attr("onclick","formerImg()").text("Back").style("color","#d3d3d3")}function hideIntro(){d3.select(".introContainer").style("display","none"),d3.select(".shadowBox").style("display","none")}function nextImg(){img+=1,4>img&&img>0&&(is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png").style("display","block"),d3.select("#intro-Slides").text(introSlides[img].slideText),d3.select("#backButton").style("color","#3b97cc")),3==img&&d3.select("#nextButton").text("Close"),4==img&&hideIntro()}function formerImg(){img>0&&(img-=1,is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png"),d3.select("#nextButton").html("Next"),d3.select("#intro-Slides").text(introSlides[img].slideText),0==img&&(d3.select(".oceanDivide").style("display","none"),d3.select("#backButton").style("color","#d3d3d3")))}function colorize(e){var t=e.properties?e.properties:e;switch(t.Country){case"Canada":return"rgb(27,158,119)";case"Russia":return"rgb(217,95,2)";case"Norway":return"rgb(117,112,179)";case"Denmark":return"rgb(166,118,29)";case"United States":return"rgb(102,166,30)";case"USSR":return"rgb(217,95,2)";default:return"Yes"==t.Dispute?"rgb(231,41,138)":"rgb(230,171,2)"}}var currentYear=1903,yearList=[],eventList=[],width=window.innerWidth,timelineWidth=width-140,selectedEvent,img=0,infoPanelBoxWidth=270,introSlides=[];window.onload=initialize();