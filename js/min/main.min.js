function initialize(){setMap(),setWelcomeScreen()}function setWelcomeScreen(){d3.select("body").style("background-image","url(http://i.imgur.com/PKscn22.jpg?1)").style("background-size","100% auto"),d3.select("body").append("div").attr("id","welcomeInfo").text("In the past century advances in human technology coupled with climatic change has made the formidable arctic accessible!")}function setMap(){function e(e,t,a,r){n.selectAll(".landMasses").data(topojson.feature(t,t.objects.landOutline).features).enter().append("g").attr("class","landMasses").append("path").attr("class","landBody").attr("d",i),n.selectAll(".line").data(topojson.feature(a,a.objects.Test_Lines).features).enter().append("g").attr("class","line").attr("id",function(e){return e.properties.EvID}).append("path").attr("d",i).on("click",function(e){selectedEvent=e,console.log(selectedEvent.properties)}).on("mouseover",highlight).on("mouseout",dehighlight);addEvents(a,r),selectedEvent=eventList[0],makeTimeline(),makeEventLine(),updateLines(),makeInfoPanel(),updateInfoPanel()}var t=700,a=700,r=(d3.select("body").append("div").attr("class","timelineBox").style("display","none").append("div").attr("class","shadowBox").attr("id","timelineBoxShadow"),d3.select("body").append("div").attr("class","infoPanelBox").style("display","none"),d3.select("body").append("div").attr("class","mapContainer").style("display","none"));r.append("text").attr("class","displayYear").text(currentYear);var n=(d3.select(".mapContainer").append("div").attr("class","shadowBox").attr("id","mapContainerShadow"),d3.select(".mapContainer").append("svg").attr("class","map").attr("width",t).attr("height",a)),s=d3.geo.orthographic().scale(500).rotate([0,-90,0]).translate([t/2,a/2]).clipAngle(90).precision(.1),i=d3.geo.path().projection(s),o=d3.geo.graticule();n.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",i),n.append("use").attr("class","sphereFill").attr("xlink:href","#sphere"),n.append("use").attr("class","sphereStroke").attr("xlink:href","#sphere"),n.append("path").datum(o).attr("class","graticule").attr("d",i);var c=d3.dsv(";","text/plain");queue().defer(d3.json,"data/landOutline.topojson").defer(d3.json,"data/Test_Lines.topojson").defer(c,"data/treatyData.csv").await(e)}function highlight(e){var t=e.properties?e.properties:e;d3.selectAll("#"+t.EvID).style("stroke-width","3px")}function dehighlight(e){var t=e.properties?e.properties:e;d3.selectAll("#"+t.EvID).style("stroke-width","1.5px")}function updateYear(){var e=d3.select(".displayYear");e.text(currentYear)}function updateLines(){d3.selectAll(".line").style("stroke",function(e){return e.properties.Year==currentYear?colorize(e):"none"})}function makeTimeline(){function e(){var e=s.extent()[0];d3.event.sourceEvent&&(e=n.invert(d3.mouse(this)[0]),s.extent([e,e])),l.attr("cx",n(e))}function t(){if(d3.event.sourceEvent){var e=s.extent()[0];s.extent([e,e]),d3.select(this).transition().duration(0).call(s.event),d3.select(this).transition().call(s.extent(s.extent().map(function(e){currentYear=d3.round(e,0);for(var t=!1;0==t;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>=2014&&(currentYear=2014,t=!0)):t=!0;return currentYear}))).call(s.event),updateInfoPanel(),updateLines(),updateYear()}}var a=d3.select(".timelineBox"),r=d3.select(".timelineBox").append("span").attr("class","buttonBox"),n=(r.append("button").attr("class","Button").attr("id","backYear").on("click",function(){currentYear+=-1;for(var e=!1;0==e;)-1==$.inArray(currentYear,yearList)?(currentYear+=-1,1903>currentYear&&(currentYear=2014,e=!0)):e=!0;moveHandle(),updateYear(),updateLines()}).text("<"),r.append("button").attr("class","Button").attr("id","nextYear").on("click",function(){currentYear++;for(var e=!1;0==e;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>2014&&(currentYear=1903,e=!0)):e=!0;console.log("hi"),moveHandle(),updateYear(),updateLines()}).text(">"),d3.scale.linear().domain([1903,2014]).range([0,timelineWidth]).clamp(!0)),s=d3.svg.brush().x(n).extent([0,0]).on("brush",e).on("brushend",t),i=d3.svg.axis().scale(n).tickValues([1903,2014]).tickFormat(d3.format("d")).orient("top"),o=a.append("svg").attr("width",width).attr("height",32).attr("class","timeline").append("g").attr("transform","translate(85, 25)").attr("class","axis").call(i),c=o.append("g").attr("class","slider").call(s);c.selectAll(".extent, .resize").remove();var l=c.append("circle").attr("class","handle").attr("r",7);c.call(s.event).transition().duration(750).call(s.extent([70,70])).call(s.event)}function makeEventLine(){{var e=d3.select(".timelineBox"),t=e.append("svg").attr("width",width).attr("height",96).attr("class","eventBox"),a=t.append("g").attr("class","eventsLine").attr("transform","translate(85.5, 4)"),r=(a.selectAll("event").data(eventList).enter().append("circle").attr("transform",function(e){var t,a=e.properties?e.properties:e,r=timelineWidth/111*(Number(a.Year)-1903);switch(a.Country){case"Canada":t=6;break;case"Russia":t=20;break;case"Norway":t=34;break;case"Denmark":t=48;break;case"United States":t=62;break;case"USSR":t=20;break;default:t=78}return"translate("+r+", "+t+")"}).attr("stroke",colorize).attr("r",6).attr("class","event").attr("id",function(e){var t=e.properties?e.properties:e;return t.EvID}).attr("fill","transparent").on("click",function(e){var t=e.properties?e.properties:e;currentYear=t.Year,selectedEvent=e;var a=d3.transform(d3.select(this).attr("transform")),r=a.translate[0];moveHandle(r),updateInfoPanel(),updateLines(),updateYear()}).on("mouseover",highlight).on("mouseout",dehighlight),["Canada:","Russia:","Norway:","United States:","Denmark:","Treaties:"]);a.selectAll("countryLabels").data(r).enter().append("g").attr("class","countryLabels").attr("id",function(e){}).append("text").text(function(e){return e}).attr("transform",function(e){switch(e){case"Canada:":y=6;break;case"Russia:":y=20;break;case"Norway:":y=34;break;case"Denmark:":y=48;break;case"United States:":y=62;break;case"Treaties:":y=78}return"translate(-80, "+(y+5)+")"}).attr("fill",function(e){switch(e){case"Canada:":return"rgb(153, 154, 184)";case"Russia:":return"rgb(237, 223, 222)";case"Norway:":return"rgb(71, 81, 102)";case"Denmark:":return"rgb(78, 99, 99)";case"United States:":return"rgb(193, 209, 219)";case"USSR:":return"rgb(237, 223, 222)";default:return"rgb(51, 196, 191)"}})}}function moveHandle(e){var t;e?t=e:(console.log("ugh"),t=timelineWidth/111*(currentYear-1903)),d3.select(".handle").transition().duration(700).attr("cx",t)}function makeInfoPanel(){d3.select(".infoPanelBox").append("div").attr("id","accordion").html("<h3 id='eventName'>Event 1</h3><div><p id='eventDescrip'></p></div>"),$("#accordion").accordion({collapsible:!0,heightStyle:"content"})}function updateInfoPanel(){var e,t,a=selectedEvent.properties?selectedEvent.properties:selectedEvent;t=a.Name,e=a.Descrip,d3.select("#eventDescrip").text(e),d3.select("#eventName").text(t)}function changeVisibility(){d3.select(".timelineBox").transition().duration(1e3).style("display","block"),d3.select(".infoPanelBox").style("display","block"),d3.select(".mapContainer").style("display","block"),d3.select("#welcomeInfo").style("display","none"),d3.select("#startButton").style("display","none"),setIntroBox()}function addEvents(e,t){for(var a=e.objects.Test_Lines.geometries,r=0;r<a.length;r++)eventList.push(a[r]),yearList.push(a[r].properties.Year);for(var n=t,r=0;r<n.length;r++)eventList.push(n[r]),yearList.push(Number(n[r].Year));eventList.sort(function(e,t){var a=e.properties?e.properties:e,r=t.properties?t.properties:t;return a.Year-r.Year})}function setIntroBox(){is=img.toString();var e=d3.select("body").append("div").attr("class","introContainer"),t=d3.select(".introContainer").append("div").attr("class","imageBox");e.append("text").attr("class","introTitle").text("Dividing Oceans: The Basics").append("hr"),t.append("img").attr("class","oceanDivide").attr("src","img/OceanDivide"+is+".png").attr("alt","ocean divide"+is).style("display","none"),e.append("button").attr("class","Button").attr("id","SkipButton").attr("onclick","hideIntro()").text("Skip"),e.append("button").attr("class","Button").attr("id","nextButton").attr("onclick","nextImg()").text("Next"),e.append("button").attr("class","Button").attr("id","backButton").attr("onclick","formerImg()").text("Back").style("color","#d3d3d3")}function hideIntro(){d3.select(".introContainer").style("display","none"),d3.select(".shadowBox").style("display","none"),d3.select("#mapContainerShadow").style("display","none")}function nextImg(){img+=1,4>img&&img>0&&(is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png").style("display","block"),d3.select("#backButton").style("color","#3b97cc")),3==img&&d3.select("#nextButton").text("Close"),4==img&&hideIntro()}function formerImg(){img>0&&(img-=1,is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png"),d3.select("#nextButton").html("Next"),0==img&&(d3.select(".oceanDivide").style("display","none"),d3.select("#backButton").style("color","#d3d3d3")))}function colorize(e){var t=e.properties?e.properties:e;switch(t.Country){case"Canada":return"rgb(153, 154, 184)";case"Russia":return"rgb(237, 223, 222)";case"Norway":return"rgb(71, 81, 102)";case"Denmark":return"rgb(78, 99, 99)";case"United States":return"rgb(193, 209, 219)";case"USSR":return"rgb(237, 223, 222)";default:return"rgb(51, 196, 191)"}}var currentYear=1903,yearList=[],eventList=[],width=980,timelineWidth=width-110,selectedEvent,img=0;window.onload=initialize();