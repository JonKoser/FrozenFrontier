function initialize(){setMap(),setWelcomeScreen()}function setWelcomeScreen(){d3.select("body").style("background-image","url(http://i.imgur.com/PKscn22.jpg?1)").style("background-size","100% auto"),d3.select("body").append("div").attr("id","welcomeInfo").text("In the past century advances in human technology coupled with climatic change has made the formidable arctic accessible!")}function setMap(){function e(e,t,a){s.selectAll(".landMasses").data(topojson.feature(t,t.objects.landOutline).features).enter().append("g").attr("class","landMasses").append("path").attr("class","landBody").attr("d",l),s.selectAll(".line").data(topojson.feature(a,a.objects.Test_Lines).features).enter().append("g").attr("class","line").append("path").attr("class",function(e){return e.properties.Year}).attr("d",l).on("click",function(e){console.log(e.properties.Descrip)}).on("mouseover",function(){console.log("over")});addEvents(a),makeTimeline(),makeEventLine(),updateLines()}var t=700,a=700,n=(d3.select("body").append("div").attr("class","timelineBox").style("display","none"),d3.select("body").append("div").attr("class","infoPanelBox").style("display","none"));makeInfoPanel(n);var r=d3.select("body").append("div").attr("class","mapContainer").style("display","none");r.append("text").attr("class","displayYear").text(currentYear);var s=d3.select(".mapContainer").append("svg").attr("class","map").attr("width",t).attr("height",a),i=d3.geo.orthographic().scale(500).rotate([0,-90,0]).translate([t/2,a/2]).clipAngle(90).precision(.1),l=d3.geo.path().projection(i),o=d3.geo.graticule();s.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",l),s.append("use").attr("class","sphereFill").attr("xlink:href","#sphere"),s.append("use").attr("class","sphereStroke").attr("xlink:href","#sphere"),s.append("path").datum(o).attr("class","graticule").attr("d",l),queue().defer(d3.json,"data/landOutline.topojson").defer(d3.json,"data/Test_Lines.topojson").await(e)}function updateYear(){var e=d3.select(".displayYear");e.text(currentYear)}function updateLines(){d3.selectAll(".line").style("stroke",function(e){if(e.properties.Year!=currentYear)return"none";switch(e.properties.Country){case"Canada":return"yellow";case"Russia":return"red";case"Norway":return"blue";case"Denmark":return"black";case"United States":return"green";case"Norway, Russia":return"purple";case"USSR":return"red";default:return"turquois"}})}function makeTimeline(){function e(){var e=r.extent()[0];d3.event.sourceEvent&&(e=n.invert(d3.mouse(this)[0]),r.extent([e,e])),o.attr("cx",n(e))}function t(){if(d3.event.sourceEvent){var e=r.extent()[0];r.extent([e,e]),d3.select(this).transition().duration(0).call(r.event),d3.select(this).transition().call(r.extent(r.extent().map(function(e){currentYear=d3.round(e,0);for(var t=!1;0==t;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>=2014&&(currentYear=2014,t=!0)):t=!0;return currentYear}))).call(r.event),updateLines(),updateYear()}}var a=d3.select(".timelineBox"),n=d3.scale.linear().domain([1903,2014]).range([0,timelineWidth]).clamp(!0),r=d3.svg.brush().x(n).extent([0,0]).on("brush",e).on("brushend",t),s=d3.svg.axis().scale(n).tickValues([1903,2014]).tickFormat(d3.format("d")).orient("top"),i=a.append("svg").attr("width",width).attr("height",50).attr("class","timeline").append("g").attr("transform","translate(20, 25)").attr("class","axis").call(s),l=i.append("g").attr("class","slider").call(r);l.selectAll(".extent, .resize").remove();var o=l.append("circle").attr("class","handle").attr("r",7);l.call(r.event).transition().duration(750).call(r.extent([70,70])).call(r.event)}function makeEventLine(){{var e=d3.select(".timelineBox"),t=e.append("svg").attr("width",width).attr("height",70).attr("class","eventBox"),a=t.append("g").attr("class","eventsLine").attr("transform","translate(22, 10)");a.selectAll("event").data(eventList).enter().append("circle").attr("transform",function(e){var t=timelineWidth/111*(e.properties.Year-1903);return e.properties,"translate("+t+", 0)"}).attr("r",4).attr("class","event").attr("fill","white").on("click",function(e){currentYear=e.properties.Year;var t=d3.transform(d3.select(this).attr("transform")),a=t.translate[0];d3.select(".handle").attr("cx",a),updateLines(),updateYear(),console.log(e.properties.Descrip)})}}function makeInfoPanel(){console.log("hyup"),d3.select(".infoPanelBox").append("div").attr("id","accordion").html("<h3>Event 1</h3><div><p>d.properties.Descrip</p></div><h3>Event 2</h3><div><p>Detailsss</p></div>"),$(function(){$("#accordion").accordion({collapsible:!0})})}function changeVisibility(){d3.select(".timelineBox").transition().duration(1e3).style("display","block"),d3.select(".infoPanelBox").style("display","block"),d3.select(".mapContainer").style("display","block"),d3.select("#welcomeInfo").style("display","none"),d3.select("#button").style("display","none")}function addEvents(e){for(var t=e.objects.Test_Lines.geometries,a=0;a<t.length;a++)eventList.push(t[a]),yearList.push(t[a].properties.Year)}var currentYear=1903,yearList=[],eventList=[],width=980,timelineWidth=width-40;window.onload=initialize();