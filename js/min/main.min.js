function initialize(){setMap(),setWelcomeScreen()}function setWelcomeScreen(){d3.select("body").style("background-image","url(http://i.imgur.com/PKscn22.jpg?1)").style("background-size","100% auto"),d3.select("body").append("div").attr("id","welcomeInfo").text("In the past century advances in human technology coupled with climatic change has made the formidable arctic accessible!")}function setMap(){function e(e,t,a){r.selectAll(".landMasses").data(topojson.feature(t,t.objects.landOutline).features).enter().append("g").attr("class","landMasses").append("path").attr("class","landBody").attr("d",i),r.selectAll(".line").data(topojson.feature(a,a.objects.Test_Lines).features).enter().append("g").attr("class","line").attr("id",function(e){return e.properties.EvID}).append("path").attr("d",i).on("click",function(e){selectedEvent=e,console.log(selectedEvent.properties)}).on("mouseover",highlight).on("mouseout",dehighlight);addEvents(a),selectedEvent=eventList[0],makeTimeline(),makeEventLine(),updateLines(),makeInfoPanel(),updateInfoPanel()}var t=700,a=700,n=(d3.select("body").append("div").attr("class","timelineBox").style("display","none"),d3.select("body").append("div").attr("class","infoPanelBox").style("display","none"),d3.select("body").append("div").attr("class","mapContainer").style("display","none"));n.append("text").attr("class","displayYear").text(currentYear);var r=d3.select(".mapContainer").append("svg").attr("class","map").attr("width",t).attr("height",a),s=d3.geo.orthographic().scale(500).rotate([0,-90,0]).translate([t/2,a/2]).clipAngle(90).precision(.1),i=d3.geo.path().projection(s),l=d3.geo.graticule();r.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",i),r.append("use").attr("class","sphereFill").attr("xlink:href","#sphere"),r.append("use").attr("class","sphereStroke").attr("xlink:href","#sphere"),r.append("path").datum(l).attr("class","graticule").attr("d",i),queue().defer(d3.json,"data/landOutline.topojson").defer(d3.json,"data/Test_Lines.topojson").await(e)}function highlight(e){d3.selectAll("#"+e.properties.EvID).style("stroke-width","3px")}function dehighlight(e){d3.selectAll("#"+e.properties.EvID).style("stroke-width","1.5px")}function updateYear(){var e=d3.select(".displayYear");e.text(currentYear)}function updateLines(){d3.selectAll(".line").style("stroke",function(e){if(e.properties.Year!=currentYear)return"none";switch(e.properties.Country){case"Canada":return"yellow";case"Russia":return"red";case"Norway":return"blue";case"Denmark":return"black";case"United States":return"green";case"USSR":return"red";default:return"purple"}})}function makeTimeline(){function e(){var e=r.extent()[0];d3.event.sourceEvent&&(e=n.invert(d3.mouse(this)[0]),r.extent([e,e])),o.attr("cx",n(e))}function t(){if(d3.event.sourceEvent){var e=r.extent()[0];r.extent([e,e]),d3.select(this).transition().duration(0).call(r.event),d3.select(this).transition().call(r.extent(r.extent().map(function(e){currentYear=d3.round(e,0);for(var t=!1;0==t;)-1==$.inArray(currentYear,yearList)?(currentYear++,currentYear>=2014&&(currentYear=2014,t=!0)):t=!0;return currentYear}))).call(r.event),updateInfoPanel(),updateLines(),updateYear()}}var a=d3.select(".timelineBox"),n=d3.scale.linear().domain([1903,2014]).range([0,timelineWidth]).clamp(!0),r=d3.svg.brush().x(n).extent([0,0]).on("brush",e).on("brushend",t),s=d3.svg.axis().scale(n).tickValues([1903,2014]).tickFormat(d3.format("d")).orient("top"),i=a.append("svg").attr("width",width).attr("height",32).attr("class","timeline").append("g").attr("transform","translate(85, 25)").attr("class","axis").call(s),l=i.append("g").attr("class","slider").call(r);l.selectAll(".extent, .resize").remove();var o=l.append("circle").attr("class","handle").attr("r",7);l.call(r.event).transition().duration(750).call(r.extent([70,70])).call(r.event)}function makeEventLine(){{var e=d3.select(".timelineBox"),t=e.append("svg").attr("width",width).attr("height",80).attr("class","eventBox"),a=t.append("g").attr("class","eventsLine").attr("transform","translate(85.5, 4)"),n=(a.selectAll("event").data(eventList).enter().append("circle").attr("transform",function(e){var t,a=timelineWidth/111*(e.properties.Year-1903);switch(e.properties.Country){case"Canada":t=6;break;case"Russia":t=20;break;case"Norway":t=34;break;case"Denmark":t=48;break;case"United States":t=62;break;case"USSR":t=20;break;default:t=6}return"translate("+a+", "+t+")"}).attr("stroke",function(e){switch(e.properties.Country){case"Canada":return"yellow";case"Russia":return"red";case"Norway":return"blue";case"Denmark":return"White";case"United States":return"green";case"USSR":return"red";default:return"purple"}}).attr("r",6).attr("class","event").attr("id",function(e){return e.properties.EvID}).attr("fill","transparent").on("click",function(e){currentYear=e.properties.Year,selectedEvent=e;var t=d3.transform(d3.select(this).attr("transform")),a=t.translate[0];d3.select(".handle").transition().duration(700).attr("cx",a),updateInfoPanel(),updateLines(),updateYear()}).on("mouseover",highlight).on("mouseout",dehighlight),["Canada:","Russia:","Norway:","United States:","Denmark:"]);a.selectAll("countryLabels").data(n).enter().append("g").attr("class","countryLabels").append("text").text(function(e){return e}).attr("transform",function(e){switch(e){case"Canada:":y=6;break;case"Russia:":y=20;break;case"Norway:":y=34;break;case"Denmark:":y=48;break;case"United States:":y=62;break;default:y=6}return"translate(-80, "+(y+5)+")"}).attr("fill",function(e){switch(e){case"Canada:":return"yellow";case"Russia:":return"red";case"Norway:":return"blue";case"Denmark:":return"White";case"United States:":return"green";case"USSR:":return"red";default:return"purple"}})}}function makeInfoPanel(){d3.select(".infoPanelBox").append("div").attr("id","accordion").html("<h3 id='eventName'>Event 1</h3><div><p id='eventDescrip'></p></div>"),$("#accordion").accordion({collapsible:!0,heightStyle:"content"})}function updateInfoPanel(){var e,t;t=selectedEvent.properties.Name,e=selectedEvent.properties.Descrip,d3.select("#eventDescrip").text(e),d3.select("#eventName").text(t)}function changeVisibility(){d3.select(".timelineBox").transition().duration(1e3).style("display","block"),d3.select(".infoPanelBox").style("display","block"),d3.select(".mapContainer").style("display","block"),d3.select("#welcomeInfo").style("display","none"),d3.select("#startButton").style("display","none"),setIntroBox()}function addEvents(e){for(var t=e.objects.Test_Lines.geometries,a=0;a<t.length;a++)eventList.push(t[a]),yearList.push(t[a].properties.Year);eventList.sort(function(e,t){return e.properties.Year-t.properties.Year})}function setIntroBox(){is=img.toString();var e=d3.select("body").append("div").attr("class","introContainer"),t=d3.select(".introContainer").append("div").attr("class","imageBox");e.append("text").attr("class","introTitle").text("Dividing oceans: The theory").append("hr"),t.append("img").attr("class","oceanDivide").attr("src","img/OceanDivide"+is+".png").attr("alt","ocean divide"+is),e.append("button").attr("class","Button").attr("id","SkipButton").attr("onclick","hideIntro()").html("Skip"),e.append("button").attr("class","Button").attr("id","nextButton").attr("onclick","nextImg()").html("Next"),e.append("button").attr("class","Button").attr("id","backButton").attr("onclick","formerImg()").html("Back").style("color","#d3d3d3")}function hideIntro(){d3.select(".introContainer").style("display","none")}function nextImg(){5>img&&(img+=1,console.log("plus ",img),is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png"),d3.select("#backButton").style("color","#3b97cc")),4==img&&d3.select("#nextButton").html("Close"),5==img&&hideIntro()}function formerImg(){img>1&&(img-=1,console.log("minus ",img),is=img.toString(),d3.select(".oceanDivide").attr("src","img/OceanDivide"+is+".png"),d3.select("#nextButton").html("Next"),1==img&&d3.select("#backButton").style("color","#d3d3d3"))}var currentYear=1903,yearList=[],eventList=[],width=980,timelineWidth=width-110,selectedEvent,img=1;window.onload=initialize();